---
import BaseLayout from '../layouts/BaseLayout.astro';
import GalleryHeader from '../components/Gallery-LandingHeader.jsx';
import GalleryInfo from '../components/GalleryInfo.jsx';
import ChapterViewer from '../components/Chapter-CivilWarBW.jsx';
import Footer from '../components/Footer.astro';

import { galleryData as allImages } from '../data/Galleries/Painterly-Fine-Art-Photography/Facing-History/Civil-War-Portraits/Black-White.mjs';
import { landingWestern } from '../data/Galleries/Painterly-Fine-Art-Photography/Facing-History/Civil-War-Portraits/landingstones.ts';
import { getStructuredData } from '../components/utils/getStructuredData.ts';

const { breadcrumb, entranceData, initialImageId } = Astro.props;

const isGhost = !initialImageId || initialImageId === "i-k4studios";
const isDeepLink = !!initialImageId && initialImageId !== "i-k4studios";

const currentImage = isGhost
  ? null
  : allImages.find(img => img.id === initialImageId && img.visibility !== "ghost");

const previewImages = allImages
  .filter(img => img.visibility !== "ghost")
  .slice(0, 8);

const imageStructuredData = currentImage
  ? getStructuredData({ type: "image", data: currentImage })
  : getStructuredData({
      type: "gallery",
      data: {
        title: landingWestern.title,
        description: landingWestern.subtitle,
        url: "/Galleries/Painterly-Fine-Art-Photography/Facing-History/Civil-War-Portraits/Black-White"
      },
      images: previewImages
    });
---

<BaseLayout 
  title="Facing History: Civil War Themed Art â€“ Photography" 
  structuredDataJSON={imageStructuredData}
>
  <div id="gallery-page" class="relative">

    <!-- Header -->
    <div id="header-section" class="relative z-10">
      <GalleryHeader client:load breadcrumb={breadcrumb} />
    </div>

    <!-- Spacer below header -->
    <div class="h-0 md:h-5"></div>

    <!-- Render either the intro or chapter viewer directly on SSR -->
    {isDeepLink ? (
      <div id="chapter-section" class="pt-4">
        <ChapterViewer client:load initialImageId={initialImageId || "i-k4studios"} />
      </div>
    ) : (
      <div id="intro-section" class="pt-4">
        <GalleryInfo client:load entranceData={entranceData} />
      </div>
    )}

    <!-- Footer always in flow, after whichever section is rendered -->
    <Footer 
      previewImages={previewImages}
      previewPath="/Galleries/Painterly-Fine-Art-Photography/Facing-History/Civil-War-Portraits/Black-White"
    />
  </div>

  <style>
    #gallery-page {
      width: 100%;
    }

    #chapter-section,
    #intro-section {
      max-width: 100%;
    }

    @media (max-width: 767px) {
      #nav-toggle {
        display: none !important;
      }
    }

    .hamburger-circle {
      display: none !important;
    }
  </style>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const exploreButton = document.querySelector('.explore-button');
      const header = document.getElementById('header-section');
      const intro = document.getElementById('intro-section');
      const chapter = document.getElementById('chapter-section');

      if (exploreButton && intro && chapter) {
        exploreButton.addEventListener('click', () => {
          header?.classList.add('hidden');
          intro?.classList.add('hidden');
          chapter?.classList.remove('hidden');
        });
      }

      document.addEventListener('contextmenu', function (e) {
        if (e.target.tagName === 'IMG') {
          e.preventDefault();
        }
      });
    });
  </script>
</BaseLayout>
